# Архитектурное решение по кешированию

## Мотивация

Внедрение кеширования решит несколько проблем:
1. **Снижение нагрузки на серверы**: Система MES и другие приложения генерируют значительный объём запросов к базе данных, что создаёт нагрузку на серверы и замедляет работу пользователей. Кеширование позволит снизить количество обращений к базе данных за часто запрашиваемыми данными.

2. **Ускорение работы страниц MES**: Операторы жалуются на долгую загрузку страницы с заказами, что связано с большим количеством данных и запросов, которые необходимо выполнить. Кеширование данных на уровне сервера или клиента может значительно уменьшить время отклика.

3. **Улучшение опыта пользователей**: Для клиентов важно быстро получать расчёты стоимости и статус заказов. Быстрое выполнение операций в системе приведёт к улучшению пользовательского опыта и поможет избежать утраты клиентов из-за медленной работы системы.

### Какие элементы системы будут включены в кеширование:
- **Статусы заказов**: Это часто запрашиваемая информация, и её не требуется обновлять с высокой частотой. Кеширование статусов позволит ускорить процесс получения данных для операторов и клиентов.

- **Результаты расчётов стоимости**: Стоимость расчёта не меняется каждый раз при запросе одного и того же изделия, поэтому кеширование расчётов стоимости может существенно снизить нагрузку на серверы и ускорить обработку заказов.

- **Данные клиентов**: Информация о клиентах, такие как их профиль, адрес доставки, предпочтения и история заказов, может быть закеширована для улучшения скорости работы CRM и MES.

## Предлагаемое решение

### Выбор типа кеширования
В данном случае оптимальным решением будет использование **серверного кеширования**. Причины, по которым мы выбираем именно серверное кеширование, следующие:
- **Централизованное управление кешем**: Серверное кеширование позволяет централизованно управлять данными, которые хранятся в кеше, и быстро обновлять их при изменении. Это особенно важно для критически важных данных, таких как результаты расчётов или статус заказа.
- **Контроль над сроком жизни данных**: В отличие от клиентского кеширования, серверное кеширование позволяет легче контролировать срок жизни данных и гарантировать их актуальность.

### Паттерн кеширования
Мы будем использовать **паттерн Cache-Aside**. При этом данные будут загружаться в кеш только по запросу и удаляться из кеша при необходимости. Этот паттерн подходит, так как:
- **Часто используемые данные**: Статусы заказов и результаты расчётов стоимости — это данные, которые часто запрашиваются, но меняются относительно редко. Паттерн Cache-Aside позволит закешировать их и сократить количество запросов к базе данных.
- **Обновление данных**: Когда данные обновляются (например, расчёт стоимости), они будут перезагружаться в кеш, что позволит обеспечить актуальность данных.

#### Почему не подходит другой паттерн?
1. **Write-Through**: В этом паттерне данные всегда записываются сначала в кеш, а затем в базу данных. Это может замедлить систему при записи, так как каждое изменение потребует обновления кеша и базы данных, что излишне для часто читаемых данных, таких как статус заказа.

2. **Refresh-Ahead**: Этот паттерн обновляет кеш заранее (например, перед истечением срока жизни данных). Он не подходит, так как может привести к избыточным операциям по обновлению кеша, даже если данные не меняются.

### Технологии кеширования
- **Redis**: Для серверного кеширования будет использоваться Redis. Это высокопроизводительная база данных в памяти, идеально подходящая для кеширования часто запрашиваемых данных.
    - **Использование Redis**: Каждое приложение (Онлайн-магазин, CRM и MES) будет взаимодействовать с Redis для хранения данных, таких как статусы заказов и результаты расчётов.
    - **Политика TTL (Time-To-Live)**: Установим срок жизни кешированных данных, чтобы не хранить устаревшую информацию.

### План внедрения кеширования
1. **Кеширование статусов заказов**: Все запросы на получение статуса заказа будут направляться сначала в Redis. Если статус заказа не найден в кеше, будет выполняться запрос в базу данных.
2. **Кеширование расчётов стоимости**: Результаты расчётов будут сохраняться в кеше с привязкой к уникальному идентификатору заказа и клиенту. Это позволит ускорить процесс повторных расчётов для того же самого изделия.
3. **Кеширование данных клиентов**: Профили клиентов будут кешироваться с ограничением по времени, чтобы избежать устаревания данных.
