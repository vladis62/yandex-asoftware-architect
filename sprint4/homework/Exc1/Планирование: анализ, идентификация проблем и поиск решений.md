# Анализ системы и предложения по улучшению

## Проблемные места

### 1. Рост нагрузки и узкие места в обработке заказов
- Архитектура не масштабируется автоматически:
    - Один инстанс на каждое приложение (онлайн-магазин, CRM, MES) может стать узким местом.
    - База данных с одним инстансом для записи и чтения является точкой отказа и ограничивает производительность.
- Расчёт стоимости заказа в MES занимает от 2 до 30 минут, увеличивая задержки и создавая очереди.

### 2. Интеграция через RabbitMQ
- Очереди сообщений между CRM и MES переполняются или неправильно обрабатываются из-за роста количества заказов.
- Обработка сообщений API от сторонних продавцов увеличила нагрузку, усугубляя задержки.

### 3. Опыт операторов и пользователей
- Дашборд MES тормозит из-за большого количества заказов, несмотря на фильтры и пагинацию.
- Отображение новых заказов затруднено, что приводит к задержкам в их обработке.

### 4. Проблемы API
- Увеличение объема заказов через API привело к недовольству сторонних клиентов из-за невыполнения заказов.
- Потеря крупных контрактов свидетельствует о недостаточной надёжности API.

### 5. Ручное управление процессами CI/CD
- Отсутствие автоматического деплоя в продакшн и релизные окружения замедляет устранение багов и внедрение улучшений.

---

## Инициативы для устранения проблем

### Высокий приоритет
1. **Масштабирование инфраструктуры**
    - Перевести приложения на автоштабируемые группы инстансов (Auto Scaling Groups).
    - Перейти на распределённые базы данных с выделенными инстансами для чтения и записи.
    - Настроить мониторинг RabbitMQ для предотвращения переполнения очередей.

2. **Оптимизация MES**
    - Вынести расчёт стоимости в отдельный микросервис с возможностью асинхронного выполнения.
    - Кэшировать результаты расчётов для часто встречающихся моделей.
    - Оптимизировать загрузку дашборда MES: подгружать только новые заказы и ограничивать размер отображаемых данных.

3. **Улучшение API**
    - Ввести SLA для API, чтобы гарантировать определённое время ответа.
    - Логировать все вызовы API для анализа проблем и предотвращения их повторения.
    - Разделить API для внутренних и внешних клиентов с приоритетной обработкой внутренних заказов.

### Средний приоритет
4. **Модернизация CI/CD**
    - Автоматизировать деплой в продакшн после прохождения всех проверок.
    - Внедрить Blue-Green или Canary деплоймент для безопасного обновления.

5. **Управление очередями RabbitMQ**
    - Разделить очереди по приоритету (например, для B2B и B2C заказов).
    - Настроить ретраи и дедлеттеринг для обработки ошибок.

### Низкий приоритет
6. **Аналитика и мониторинг**
    - Внедрить централизованное логирование и алертинг по критическим проблемам.
    - Вести аналитику по времени обработки заказов на каждом этапе.

7. **Обновление интерфейсов**
    - Упростить дашборд MES для операторов, выделив отдельный экран для новых заказов.

---

## Расстановка приоритетов

1. **Масштабирование инфраструктуры**
    - Решает ключевую проблему роста нагрузки.
    - Устраняет узкие места в приложениях и базах данных.

2. **Оптимизация MES**
    - Снижает задержки в обработке заказов и улучшает опыт операторов.

3. **Улучшение API**
    - Повышает надёжность взаимодействия с внешними клиентами.
    - Снижает риск потери контрактов.

---

## Целевая архитектура через полгода

1. **Эластичная инфраструктура**
    - Все приложения и базы данных автоматически масштабируются под нагрузку.
    - RabbitMQ настроен для устойчивой обработки сообщений.

2. **Оптимизированная MES**
    - Расчёт стоимости вынесен в микросервис.
    - Интерфейс MES быстро отображает новые заказы.

3. **Надёжное API**
    - SLA обеспечивает стабильную работу внешних интеграций.

4. **Автоматизированный CI/CD**
    - Новые версии безопасно и быстро доставляются в продакшн.
